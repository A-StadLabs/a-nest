'use strict';
var config = require('../config');
var Firebase = require('firebase');

function Gsmcode() {}

// exchange GSM number (parameter id ) for a custom code
// callback fn(err,code);
Gsmcode.prototype.createCode = function createCode(gsm, fn) {
  var findUser = new Firebase(config.firebase.baseurl + "/user/" + gsm + "/");
  findUser.once("value", function(snapshot) {
    var code = Math.floor(Math.random() * 900000) + 100000;
    if (snapshot.val()) {
      var usergsm = snapshot.key();
      var setCode = new Firebase(config.firebase.baseurl + "/codes/" + code + "/" + gsm + "/");
      var setLogin = new Firebase(config.firebase.baseurl + "/user/" + gsm + "/lastlogin/");
      setLogin.set(Firebase.ServerValue.TIMESTAMP);
      setCode.set(true);
    } else {
      var createUser = new Firebase(config.firebase.baseurl + "/user/" + gsm + "/");
      createUser.set({
        "gsm": gsm,
        "lastlogin": Firebase.ServerValue.TIMESTAMP,
        "avatar": {"gezicht":"data:image/png;base64,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","lijf":"data:image/png;base64,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","oogmond":"data:image/png;base64,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"}   
      });
      var setCode = new Firebase(config.firebase.baseurl + "/codes/" + code + "/" + gsm + "/");
      setCode.set(true);
    }
    fn(null, code);
  });
}

// exchange gsm+code for user
Gsmcode.prototype.getUser = function getUser(gsm, code, fn) {
  //console.log('getUser '+ gsm + ','+code);
  var findCode = new Firebase(config.firebase.baseurl + "/codes/" + code + "/");
  findCode.once("value", function(findcoderesult) {
    if (findcoderesult.val()) {
      var getUser = new Firebase(config.firebase.baseurl + "/user/" + gsm + "/");
      getUser.once("value", function(getuserresult) {
        return fn(null, getuserresult.val());
      });
    } else {
      return fn(null, null);
    }
  });
}

module.exports = new Gsmcode();