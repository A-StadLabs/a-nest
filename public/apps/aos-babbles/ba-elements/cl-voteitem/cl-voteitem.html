<link rel="import" href="../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../../../../bower_components/firebase-element/firebase-element.html">

<!--     <link rel="stylesheet" href="cl-voteitem.css"> -->
<link rel="stylesheet" href="cl-voteitem.css" />
<link rel="import" href="../../../../elements/aos-globals/aos-globals.html">

<polymer-element name="cl-voteitem" attributes="key item votes mode">
<template>

  <aos-globals id="globals" values="{{globs}}"></aos-globals>

  <firebase-element id="bericht" location="https://blazing-fire-6426.firebaseio.com/babbles/users/{{$.globals.values.user.data.id}}/votes/{{key}}/" data="{{data}}" keys="{{keys}}" on-data-change="{{handleResponse}}"></firebase-element>

    <template if="{{mode=='parent'}}">
        <div vertical layout center class="voterij">
          <svg id="btAdd" viewBox="0 0 26 14" on-tap="{{FBAddVote}}" class="{{ { highlight: vote=1 } | tokenList }}">
          <polygon points="4.619,12.94 13.015,3.524 21.399,12.633 22.617,11.512 12.995,1.06 3.382,11.84 "/>
          </polygon>
          </svg>
          <p>{{votes}} - {{vote}}</p>
          <svg id="btRem" viewBox="2 7.521 26 14" on-tap="{{FBRemVote}}" class="{{ { highlight: votee == '-1' } | tokenList }}">
          <polygon points="23.737,8.561 15.341,17.977 6.957,8.869 5.738,9.989 15.361,20.441 24.974,9.662"></polygon>
          </svg>
        </div>
      </template>

    <template if="{{mode=='child'}}">
        <div vertical layout center class="voterij">
          <svg id="btAdd" active="" viewBox="0 0 26 14" on-tap="{{FBAddVote}}" class="{{ { highlight: votee = '1' } | tokenList }}">
          <polygon points="6.295,11.752 13.012,4.219 19.719,11.506 20.693,10.609 12.996,2.248 5.305,10.872 "/></polygon>

          </svg>
          <small>{{votes}} - {{vote}}</small>
          <svg id="btRem" viewBox="2 7.521 26 14" on-tap="{{FBRemVote}}" class="{{ { highlight: votee == '-1' } | tokenList }}">
          <polygon points="22.061,9.749 15.344,17.281 8.636,9.995 7.662,10.892 15.36,19.253 23.05,10.629"></polygon>
          </svg>
        </div>
    </template>

</template>

  <script>
    (function () {
      'use strict';

      Polymer({

        publish: {
        votes: {
          reflect: true,
          value: false
        },
        
      },
        // define element prototype here
        ready: function(){
          this.vote = 'hello';
        },

        FBAddVote: function(){
          var userFB3 = new Firebase('https://blazing-fire-6426.firebaseio.com/babbles/users/'+this.$.globals.values.user.data.id+'/votes/'+this.key+'/');
          var newpostRef3 = userFB3.set(1);

          var addPlay = new Firebase('https://blazing-fire-6426.firebaseio.com/babbles/messages/'+this.key+'/votes/');
          addPlay.transaction(function(currentRank) {
            return currentRank+1;
          });

          this.$.btAdd.active = true;
        },

        FBRemVote: function(){
          var userFB4 = new Firebase('https://blazing-fire-6426.firebaseio.com/babbles/users/'+this.$.globals.values.user.data.id+'/votes/'+this.key+'/');
          var newpostRef4 = userFB4.set(-1);

          var addPlay = new Firebase('https://blazing-fire-6426.firebaseio.com/babbles/messages/'+this.key+'/votes/');
          addPlay.transaction(function(currentRank) {
            return currentRank-1;
          });
        },

        FBNoVote: function(){
          var userFB4 = new Firebase('https://blazing-fire-6426.firebaseio.com/babbles/users/'+this.$.globals.values.user.data.id+'/votes/'+this.key+'/');
          var newpostRef4 = userFB4.set(0);
        },

        handleResponse: function(){
          console.log(this.data);
          var votee = this.data[this.keys];
          console.log('vote: ', votee);
          this.vote = votee;
          console.log('vote: ', this.vote);
        }
        
     
      });

    })();
  </script>
</polymer-element>
