<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../../bower_components/core-field/core-field.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">

<polymer-element name="aos-profiel" attributes="yoyo">

  <template>
  <link rel="stylesheet" href="aos-profiel.css" />
    <aos-globals id="globals"></aos-globals>

  <template if="{{!$.globals.values.user}}">
    <div vertical layout center center-justified id="canvas">
    <h1>Aanmelden</h1>
    <small>{{error}}</small>
    <input name="username" placeholder="Gebruikersnaam" required  value="{{username}}"></input>
    <input name="password" placeholder="Wachtwoord" type="password" required value="{{password}}"></input>
    <h3 hidden?="{{!loading}}">Laden...</h3>
    <button hidden?="{{loading}}" id="buttons" center-justified icon="arrow-forward" on-tap="{{loginSubmit}}">Aanmelden</button>

   <core-ajax method="GET" id="loginAjax" handleAs="json" url="/login" response="{{responseUser}}" loading="{{loading}}" on-core-response="{{handleResponseUser}}">
   </core-ajax>
     </div>

   </template>

   <template if="{{$.globals.values.user.data}}">
   <button on-tap="{{logout}}">Logout</button>
   <img class="avatar" src="{{responseUser.data.avatarUrl}}">
    <h1>{{$.globals.values.user.data.firstName}}</h1>
    <h3>JSON userobject</h3>
    <p>{{$.globals.values.userJSON}}</p>
    <h3>CRS gegevens</h3>
    <p>{{$.globals.values.crsuserJSON}}</p>
    <h3>CRS medewerker gegevens</h3>
    <p>{{$.globals.values.crsmedewerkerJSON}}</p>
   </template>

   <core-ajax method="GET" id="logoutAjax" handleAs="json" url="/logout" response="{{responseLogout}}" on-core-response="{{handleResponseLogout}}">

   <core-ajax method="GET" id="getCRS" handleAs="json" url="/crs-persoon" response="{{responseCRS}}" on-core-response="{{handleResponseCRS}}">

   <core-ajax method="GET" id="getCRSmedewerker" handleAs="json" url="/crs-medewerker" response="{{responseCRSmedewerker}}" on-core-response="{{handleResponseCRSmedewerker}}">

  </template>

  <script>

    Polymer({

      ready: function() {

      	console.log('profiel app loaded.');
        },

        logout: function(){
          this.$.logoutAjax.go();
          delete this.$.globals.values.user;
        },

        loginSubmit: function(){
          this.$.loginAjax.params = { "username": this.username, "password": this.password };
          //this.$.loginAjax.params = { "username": "kingflurkel", "password": "mike48" };
          this.$.loginAjax.go();
        },

        handleResponseUser: function(){
          console.log('user resp:', this.responseUser.success);
          if(this.responseUser.success==true){
            this.$.globals.values.user = this.responseUser;
            this.$.globals.values.userJSON = JSON.stringify(this.$.globals.values.user.data);
            console.log('UID: ',this.responseUser.data.uid);
            this.$.getCRS.go();
            if(this.responseUser.data.ADAccount){
              this.$.getCRSmedewerker.go();
            };
          };
          if(this.responseUser.success==false){
            console.log('inlog error');
            this.error = "Er ging iets fout bij het aanmelden.";
            //delete this.$.globals.values.user;
          };
        },

        handleResponseCRS: function(){
          console.log('CRS? ', this.responseCRS.success);
          if(this.responseCRS.success){
            console.log('We hebben een eid user!');
            this.$.globals.values.crsuser = this.responseCRS.data;
            this.$.globals.values.crsuserJSON = JSON.stringify(this.responseCRS.data);
          };
        },

        handleResponseCRSmedewerker: function(){
          console.log('CRS? ', this.responseCRSmedewerker.success);
          if(this.responseCRSmedewerker.success){
            console.log('We hebben een eid user!');
            this.$.globals.values.crsmedewerker = this.responseCRSmedewerker.data;
            this.$.globals.values.crsmedewerkerJSON = JSON.stringify(this.responseCRSmedewerker.data);
          };
        }

    });

  </script>

</polymer-element>
