<link rel="import" href="../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../bower_components/core-ajax/core-ajax.html">

<polymer-element name="babbel-postcomment" attributes="tags op mother">

  <template>


<!--     <link rel="stylesheet" href="babbel-postcomment.css" />
 -->        <link rel="stylesheet" href="../../aos-babbelroot.css" />


    <core-ajax 
  id="ajaxBabbelbox" 
  url="https://blazing-fire-6426.firebaseio.com/babbelbox/.json"
  method="POST" 
  handleAs="json" 
  response="{{postResponse}}"
  on-core-response="{{handleResponse}}">
  </core-ajax>



<div id="newitem" vertical layout start>

  <div horizontal layout center wrap>
    <input autofocus placeholder="Begin een gesprek" value="{{newConversation}}" id="newConv">



    <div id="inputbtns" horizontal layout center>
    
      <button id="submitbtn" on-tap="{{submitNewConversation}}">OK</button>
    </div>
  </div>


<!--     <div id="" horizontal layout start start-justified wrap>
      <button class="itemaddons">tag toevoegen</button>
      <button class="itemaddons">bestand toevoegen</button>
    </div> -->



</div>

  </template>

  <script>

    Polymer({

      ready: function() {

      	console.log('Babbelbox entry loaded.'); 

      },

      // Nieuwe conversatie opslaan
      submitNewConversation: function(){
          this.time = new Date();
          this.postBody = { 'time': this.time, 'title': this.newConversation, 'tags':this.tags, 'op': this.op, 'mother': this.mother, 'votes': 1, 'children': 0 };
          this.$.ajaxBabbelbox.body = JSON.stringify(this.postBody);
          this.$.ajaxBabbelbox.go();
          this.$.newConv.value = '';

        
            var addPlay = new Firebase('https://blazing-fire-6426.firebaseio.com/babbelbox/'+this.mother+'/children/');
          addPlay.transaction(function(currentRank) {
            return currentRank+1;
          });

            var addVote = new Firebase('https://blazing-fire-6426.firebaseio.com/babbelbox/'+this.mother+'/votes/');
          addVote.transaction(function(currentRank) {
            return currentRank+1;
          });
          

          //Add child on mother children value

      },
      
      FBAddVote: function(){

          var addPlay = new Firebase('https://blazing-fire-6426.firebaseio.com/babbelbox/'+this.mother+'/children/');
          addPlay.transaction(function(currentRank) {
            return currentRank+1;
          });
        },

    });

  </script>

</polymer-element>
