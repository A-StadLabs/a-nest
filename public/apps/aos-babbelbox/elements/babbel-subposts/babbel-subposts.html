
<link rel="import" href="../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../bower_components/firebase-element/firebase-element.html">
<link rel="import" href="../../../../bower_components/polymer-filters/polymer-filters.html">

<link rel="import" href="../babbel-babbel/babbel-babbel.html">
<link rel="import" href="../babbel-postcomment/postcomment-babbel.html">

<polymer-element name="babbel-subposts" attributes="mother">

<template>

<link rel="stylesheet" href="../../aos-babbelroot.css" />
  
<div id="sortsubs"><button class="sortbtn" on-tap="{{sortthis}}">Sorteer op meeste votes</button></div>

<babbel-postcomment op="0" tags="child" mother="{{mother}}"></babbel-postcomment>

<template repeat="{{ l, i in childdata }}">
  <babbel-babbel key="{{l.key}}" object="{{l}}" mode="child" childOf="{{mother}}"></babbel-babbel>
</template>
  
<firebase-element id="FBanswer" location="https://blazing-fire-6426.firebaseio.com/babbelbox/" orderByChild="mother" equalTo="{{mother}}" data="{{answerdata}}" keys="{{answerkeys}}" id="fbBabbelboxanswer" on-data-change="{{handleResponse}}" log></firebase-element>
</template>

<script>
Polymer({

     ready: function() {
      	console.log('Babbelbox entry loaded.');

        var that = this;

        // document.addEventListener('babbel-selectchild', function(e){
        //      console.log('selected someo shit!', e.detail.key);
        //      that.mother = e.detail.key;
        //  }); 
    },

    iChanged: function(){
    	console.log('i changed ',this.i);
    },

    motherChanged: function(){
      this.$.FBanswer.requery();
    },

    sorting: function(a,b) {
        if (a.votes < b.votes)
          return -1;
        if (a.votes > b.votes)
          return 1;
        return 0;
      },

      sortthis: function(){
        console.log('sorteren', this.childdata);
        this.childdata.sort(this.sorting);
        this.childdata.reverse();
        console.log('gesorteerd', this.childdata);
      },

     handleResponse: function(){
        console.log('answerdata: ',this.answerdata);
        var childdata = [];
        var answerkeys = this.answerkeys;

        for (var i = answerkeys.length - 1; i >= 0; i--) {
          console.log('answer: ',this.answerdata[answerkeys[i]]);
          //console.log(this.name);
          childdata.push({ 'key': answerkeys[i],
                        'title': this.answerdata[answerkeys[i]].title,
                        'votes': this.answerdata[answerkeys[i]].votes,
                        'op': this.answerdata[answerkeys[i]].op,
                        'children': this.answerdata[answerkeys[i]].children,
                        'mother': this.answerdata[answerkeys[i]].mother,
                        'time': this.answerdata[answerkeys[i]].time,
                        'tags': this.answerdata[answerkeys[i]].tags
                      });
        };
        this.childdata = childdata;
        this.numChildren = i;
        console.log('childdata :',this.childdata);
        this.sortthis();
    	}


    });
</script>
</polymer-element>