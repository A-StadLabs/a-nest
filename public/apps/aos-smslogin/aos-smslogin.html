<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../elements/aos-globals/aos-globals.html">
<link rel="import" href="../../bower_components/core-input/core-input.html">
<link rel="import" href="../../bower_components/paper-input/paper-input-decorator.html">
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../../bower_components/core-localstorage/core-localstorage.html">
<link href="../../bower_components/core-icons/core-icons.html" rel="import">
<link rel="import" href="../../bower_components/core-animated-pages/core-animated-pages.html">
<link rel="import" href="../../bower_components/core-animated-pages/transitions/slide-from-right.html">


<polymer-element name="aos-smslogin" attributes="">

<template>

  <link rel="stylesheet" href="aos-smslogin.css" />

  <core-ajax method="GET" id="checkUser" handleAs="json" url="/user" response="{{responseCheck}}" on-core-response="{{handleResponseCheck}}" auto></core-ajax>

    <core-ajax method="GET" id="userCheck" handleAs="json" url="/usercheck" response="{{responseUser}}" on-core-response="{{handleResponseUserCheck}}"></core-ajax>

    <core-ajax method="GET" id="codeCheck" handleAs="json" url="/codecheck" response="{{responseCode}}" on-core-response="{{handleResponseCodeCheck}}"></core-ajax>

    <core-ajax method="GET" id="logout" handleAs="json" url="/logout" response="{{logoutresponse}}" on-core-response="{{handleLogout}}"></core-ajax>

  <template if="{{user==false}}">

  <core-animated-pages selected="{{section}}" transitions="" id="animPages" transitions="slide-from-right">
  <section>
  <core-localstorage name="AnestNummer" value="{{inputvalue}}"></core-localstorage>
    <div class="container" vertical layout center>
      <img src="/images/key.svg" class="avatar">

      <div>
          <paper-input label="GSM" id="input2" is="core-input" value="{{inputvalue}}"></paper-input>
        </div>
     
        <paper-button raised on-tap="{{validate}}">
        <core-icon icon="arrow-forward"></core-icon>
        </paper-button>
      </div>
    </section>
    <section>
      <div class="container">
        <h2>Verifieer code</h2>
        <div>
          <paper-input label="Code" id="code" is="core-input" value="{{codevalue}}"></paper-input>
        </div>
        <div>
          <paper-button raised on-tap="{{checkcode}}">
            <core-icon icon="arrow-forward"></core-icon>
          </paper-button>
        </div>
      </div>
    </section>
  </core-animated-pages>
  </template>

  <template if="{{user}}">
  <core-animated-pages selected="0" transitions="" flex>
    <section>
      <div class="container" vertical layout center>
        <div>Ok, je bent aangemeld.</div>
        <div><paper-button raised>Me</paper-button></div>
        <div><paper-button raised>Notifications</paper-button></div>
        <div><paper-button raised>Verification</paper-button></div>
        <div>Grid to other apps</div>
        <div><paper-button raised on-tap="{{logout}}">Logout</paper-button></div>
      </div>
    </section>
    <section id="sect_me">
      
    </section>
    <section id="sect_notifications">
      
    </section>
    <section id="sect_verification">
      
    </section>
  </core-animated-pages>
  </template>

</template>

<script>

  Polymer({

    ready: function() {
      console.log('SMS Login app loaded.'); 
      //this.user = false;
      this.section = 0;
      this.user = false;
    },

    validate: function() {
      console.log(this.inputvalue);
      var gsmnummer = this.inputvalue;
      this.$.userCheck.params = { "gsm": gsmnummer };
        //this.$.loginAjax.params = { "username": "kingflurkel", "password": "mike48" };
        this.$.userCheck.go();
        this.section = 1;
    },

    handleResponseUserCheck: function(){
      console.log(this.responseUser.code);
      this.kode = this.responseUser.code;
    },

    handleResponseCheck: function(){
      console.log(this.responseCheck.userstatus);
      if(this.responseCheck.userstatus!='E'){
        this.user = true;
        this.section = 2;
      };
      console.log(this.user);
    },

    checkcode: function(){
      var code = this.codevalue;
      var gsm = this.inputvalue;
      this.$.codeCheck.params = { "kode": code, "gsm": gsm };
      this.$.codeCheck.go();
    },

    handleResponseCodeCheck: function(){
      console.log(this.responseCode);
      this.user = true;
    },

    logout: function(){
      this.$.logout.go();
      this.user = false;
      this.$.section = 0;
    }

});

</script>

</polymer-element>
