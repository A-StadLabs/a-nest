<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/polymer-filters/polymer-filters.html">

<link rel="import" href="../aos-eobject/aos-eobject.html">

<polymer-element name="aos-eniversum" attributes="">
  <template>
    <link rel="stylesheet" href="aos-eniversum.css">
    
     <h3>E-Object admin</h3>
     
      <h2>Objecten</h2>
     <template repeat="{{ o in objectTypes }}">
        <i on-tap="{{select}}" me="{{o.key}}">{{ o.naam }}, </i> 
    </template>

    <input placeholder="Titel" value="{{objectNaam}}" name="text" id="newObject" />

    <hr><div horizontal layout>
      <div>
      
    <aos-eobject key="{{selectedItem}}"></aos-eobject>

    <p>Klik op items om ze toe te voegen als kinderen.</p>
    
    <template repeat="{{ o in objectTypes }}">
      <i on-tap="{{addChild}}" me="{{o.key}}" naam="{{o.naam}}">{{ o.naam }}, </i>  
    </template>

    </div>
    <!-- <div>
      <h2>Eigenschappen</h2>
      <input placeholder="Eigenschap" value="{{propNaam}}" name="text" id="newProp" />
      <template repeat="{{ p in properTypes }}">
        <i on-tap="{{select}}" me="{{p.key}}">{{ p.naam }}, </i> 
    </template>
    </div> -->
    </div>
  </template>
  <script>
    (function () {
      'use strict';

      Polymer({
        // define element prototype here
        select: function(e, detail, sender){
          console.log(sender.attributes.me.value);
          this.selectedItem = sender.attributes.me.value;
        },

        addChild: function(e, detail, sender){
          var parentItem = this.selectedItem;
          var key = sender.attributes.me.value;
          var naam = sender.attributes.naam.value;
          var setChild = new Firebase("https://blazing-fire-6426.firebaseio.com/eobjects/things/"+parentItem+"/children/");
          var respChild = setChild.push({ "childKey": key, "naam": naam });
          console.log(respChild);
        },

        rootMe: function(){
          this.selectedItem = 'root';
        },

        ready: function(){

          this.selectedItem = 'root';

          var that = this;

      

          var getEObjects = new Firebase("https://blazing-fire-6426.firebaseio.com/eobjects/things/");
          var objectTypes = [];
          var respEObjects = getEObjects.on("child_added", function(snap){
            objectTypes.push({'naam':snap.val().object, 'key': snap.key()});
            //console.log('naam',snap.val().object, 'icoon', snap.val().icon, ' key', snap.key());
          });
          this.objectTypes = objectTypes;

          var getProperties = new Firebase("https://blazing-fire-6426.firebaseio.com/eobjects/properties/");
          var properTypes = [];
          var respProper = getProperties.on("child_added", function(snap){
            properTypes.push({'naam':snap.val().naam, 'key': snap.key()});
            console.log('naam',snap.val().object, 'icoon', snap.val().icon, ' key', snap.key());
          });
          this.properTypes = properTypes;

          var that = this;
          // Nieuwe eloket concept stuff
        // this.objectTypes = ['partner', 'dochter', 'zoon', 'papa', 'mama', 'man', 'vrouw', 'auto', 'fiets', 'identiteitskaart (eID)', 'A-kaart'];

        this.$.newObject.addEventListener('keypress', function(e) {
          if (e.keyCode == 13) {
              that.async(function() {
              that.saveObject();
              });
          };
        });

        // this.$.newProp.addEventListener('keypress', function(e) {
        //   if (e.keyCode == 13) {
        //       that.async(function() {
        //       that.saveProp();
        //       });
        //   };
        // });

        },

        saveObject: function(){

          var naam = this.objectNaam;
          var postObject = new Firebase("https://blazing-fire-6426.firebaseio.com/eobjects/things/");
          var respObject = postObject.push({"object":naam, "parent": "root", "icon": "imagesrc", "time":Firebase.ServerValue.TIMESTAMP});
          var newObjectKey = respObject.key();
          console.log('Saved as ',newObjectKey);

          delete this.objectNaam;

          // var attraction = 'root';

          // var postAttracted = new Firebase("https://blazing-fire-6426.firebaseio.com/eobjects/things/"+newObjectKey+"/attractedTo/"+attraction+"/");
          // var respAttracted = postAttracted.set(true);
        },
        saveProp: function(){

          var naam = this.propNaam;
          var postProp = new Firebase("https://blazing-fire-6426.firebaseio.com/eobjects/properties/");
          var respProp = postProp.push({"naam":naam, "parent": "root", "icon": "imagesrc", "time":Firebase.ServerValue.TIMESTAMP});
          var newPropKey = respProp.key();
          console.log('Saved as ',newPropKey);

          delete this.propNaam;

          // var attraction = 'root';

          // var postAttracted = new Firebase("https://blazing-fire-6426.firebaseio.com/eobjects/things/"+newObjectKey+"/attractedTo/"+attraction+"/");
          // var respAttracted = postAttracted.set(true);
        }
      });

    })();
  </script>
</polymer-element>
