<link rel="import" href="../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../bower_components/firebase-element/firebase-element.html">
<link rel="import" href="../../../../bower_components/core-icon-button/core-icon-button.html">
<link rel="import" href="../../../../elements/aos-apersoon/aos-apersoon.html">
<link rel="import" href="../../../../elements/aos-aprofiel/aos-aprofiel.html">
<link rel="import" href="../../../../elements/aos-text/aos-text.html">

<polymer-element name="aos-render" attributes="type userid mode">
  <template>
    <link rel="stylesheet" href="aos-render.css" />
    <template bind if="{{ item.object == 'A-Persoon' }}">
    	<aos-apersoon type="{{type}}" userid="{{userid}}" on-tap="{{selectitem}}"></aos-apersoon>
    </template>
    <template bind if="{{ item.object == 'A-Profiel' }}">
    	<aos-aprofiel type="{{type}}" userid="{{userid}}" on-tap="{{selectitem}}"></aos-aprofiel>
    </template>
    <template bind>
        <aos-text type="{{type}}" userid="{{userid}}" on-tap="{{selectitem}}">{{item.object}}: </aos-text>
    </template>
    <!-- children hier zetten -->
    <!-- <p>{{item.object}}</p> -->
    <!-- <p>{{value}}</p> -->
    <div hidden?="{{ mode == 'child' }}"
    <core-icon-button icon="add" on-tap="{{showMagnets}}" hidden?="{{ magnets }}"></core-icon-button>
    <div hidden?="{{openDial}}">
    <template repeat="{{ o in objectMagnets}}">
        <button me="{{o.key}}" on-tap="{{addTo}}">{{ o.naam }}</button> 
    </template>
    </div>


</template>
<script>
    Polymer({
    	ready: function(){
    		this.openDial = false;
    	},

        selectitem: function(e, detail, sender){
          //console.log(sender.attributes.me.value);
          this.fire('item-select', {msg: this.type});
        },

        useridChanged: function(){
            this.typeChanged();
        },

    	typeChanged: function(){
    		var that = this;
        	var key = this.type;

        	var getItem = new Firebase("https://blazing-fire-6426.firebaseio.com/eobjects/things/"+key+"/");
        	var respItem = getItem.once('value', function(snap){
            	console.log(snap.val());
            	that.item = snap.val();
          	});

            this.getMagnets()
    	},

    	addTo: function(e, detail, sender){
    		var me = sender.attributes.me.value;
    		var type = this.type;
    		var userid = this.userid;
    		console.log('add: ', me, ' to ',type,' for user ',userid);
    		var addToFb = new Firebase("https://blazing-fire-6426.firebaseio.com/universe/user/"+userid+"/things/"+type+"/children/");
    		addToFb.push({"type":me});
    	},

    	getMagnets: function(){
    		var key = this.type;
    		var getMagnets = new Firebase("https://blazing-fire-6426.firebaseio.com/eobjects/things/"+key+"/children/");
    		var objectMagnets = [];

          var respObjects = getMagnets.on("child_added", function(snap){
            objectMagnets.push({'naam':snap.val().naam, 'key': snap.val().childKey});
            //console.log('naam',snap.val().object, 'icoon', snap.val().icon, ' key', snap.key());
          });

          this.objectMagnets = objectMagnets;

          this.magnets = true;

          if(objectMagnets.length<0){ this.magnets = false };
          console.log('magnets: ', objectMagnets.length, this.magnets);    
          
    	},

        showMagnets: function(){
            this.openDial = !this.openDial;
        }



    });
</script>
</polymer-element>